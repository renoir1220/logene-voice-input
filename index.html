<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="/src/styles.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Logene Voice Input</title>
  <script type="module" src="/src/main.ts" defer></script>
</head>

<body>
  <div id="app">
    <!-- 视图 1：Typeless 式横向胶囊悬浮窗 -->
    <div id="float-capsule-view" class="view active">
      <div class="capsule-container">
        <button id="record-btn" class="capsule-btn" title="点击录音 / Alt+Space 按住 / 双击或右键打开配置">
          <div class="idle-dots">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="wave-bars">
            <span class="bar"></span><span class="bar"></span><span class="bar"></span><span class="bar"></span><span
              class="bar"></span>
          </div>
        </button>
        <button id="vad-toggle-btn" class="vad-toggle-btn" title="VAD 监听开关 (Alt+Shift+V)" aria-pressed="false">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor" aria-hidden="true">
            <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3z" />
            <path
              d="M17 11a1 1 0 1 1 2 0 7 7 0 0 1-6 6.93V21h2a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h2v-3.07A7 7 0 0 1 5 11a1 1 0 1 1 2 0 5 5 0 1 0 10 0z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- 视图 2：主界面控制台 -->
    <div id="main-dashboard-view" class="view">
      <div class="dashboard-body">
        <!-- 侧边栏（同时整块负责窗口拖动部分） -->
        <div class="sidebar">
          <button class="menu-item active" data-tab="status">
            <svg viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z" />
              <path d="M7 12h2v5H7zm4-3h2v8h-2zm4-4h2v12h-2z" />
            </svg>状态与统计
          </button>
          <button class="menu-item" data-tab="commands">
            <svg viewBox="0 0 24 24">
              <path
                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
            </svg>语音指令表
          </button>
          <button class="menu-item" data-tab="hotwords">
            <svg viewBox="0 0 24 24">
              <path
                d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z" />
            </svg>热词
          </button>
          <button class="menu-item" data-tab="settings">
            <svg viewBox="0 0 24 24">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.06-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.73,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.06,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.49-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
            </svg>首选项
            <span id="settings-model-warning" class="menu-warning-icon" hidden title="检测到本地模型下载不完整">⚠</span>
          </button>
          <button class="menu-item" data-tab="llm">
            <svg viewBox="0 0 24 24">
              <path
                d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9zM12 4.15L6.04 7.5 12 10.85l5.96-3.35L12 4.15zM5 15.91l6 3.38v-6.71L5 9.21v6.7zm14 0v-6.7l-6 3.38v6.71l6-3.38z" />
            </svg>大模型设置
          </button>
          <button class="menu-item" data-tab="logs">
            <svg viewBox="0 0 24 24">
              <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" />
            </svg>日志
          </button>
        </div>

        <!-- 内容主区 -->
        <div class="content">
          <div class="content-header">
            <button id="close-dashboard-btn" class="close-dashboard-btn" title="收起为主面板/悬浮球">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M19 13H5v-2h14v2z" />
              </svg>
            </button>
          </div>
          <!-- 状态页 -->
          <div id="tab-status" class="tab-pane active">
            <h2 class="page-title">运行状态</h2>
            <div class="card-grid">
              <div class="stat-card">
                <div class="stat-value">就绪</div>
                <div class="stat-label">引擎状态</div>
              </div>
              <!-- 未来可在这里加入当天的输入字符数、耗时图表等 -->
              <div class="stat-card">
                <div class="stat-value">--</div>
                <div class="stat-label">今日听写次数</div>
              </div>
            </div>
            <div class="card">
              <h3>VAD 连续识别模式</h3>
              <p class="desc">在安静环境下持续聆听，说完即转换为输入。</p>
              <label class="toggle-switch">
                <input type="checkbox" id="dashboard-vad-toggle">
                <span class="slider"></span>
              </label>
            </div>
          </div>

          <!-- 语音指令页 -->
          <div id="tab-commands" class="tab-pane">
            <h2 class="page-title">专属语音触发指令</h2>
            <p class="desc">您可以把常用快捷键和口令绑定，说出"口令"系统自动产生相应的系统级键盘快捷键操作。</p>
            <div class="card">
              <div id="cmd-editor-list" class="cmd-editor-list"></div>
              <button id="add-cmd-btn" class="btn btn-outline">+ 增加映射</button>
            </div>
            <div class="actions-row">
              <div id="cmd-save-hint" class="save-hint"></div>
              <button id="save-cmd-btn" class="btn btn-primary">保存语音指令</button>
            </div>
          </div>

          <!-- 热词页 -->
          <div id="tab-hotwords" class="tab-pane">
            <h2 class="page-title">ASR 热词管理</h2>
            <p class="desc">按场景管理 ASR 热词，提升专业术语识别准确率。</p>
            <div class="hotword-scene-bar">
              <div id="scene-tabs" class="scene-tabs"></div>
              <button id="add-scene-btn" class="btn-icon" title="新增场景">+</button>
            </div>
            <div class="card">
              <div class="hotword-input-row">
                <input id="hotword-search" type="text" class="input hotword-search-input" placeholder="搜索热词..." />
              </div>
              <div class="hotword-input-row">
                <input id="hotword-input" type="text" class="input hotword-add-input" placeholder="输入热词后按 Enter 添加" />
              </div>
              <div id="hotword-tags" class="hotword-tags"></div>
            </div>
            <div class="actions-row">
              <div id="hotword-save-hint" class="save-hint"></div>
              <button id="save-hotwords-btn" class="btn btn-primary">保存热词</button>
            </div>
          </div>

          <!-- 设置页 -->
          <div id="tab-settings" class="tab-pane">
            <h2 class="page-title">底层架构设置</h2>

            <!-- ASR 识别模式 -->
            <div class="card">
              <h3>语音识别模式</h3>
              <div class="asr-mode-selector">
                <label class="asr-mode-option">
                  <input type="radio" name="asr-mode" value="api" id="asr-mode-api" checked />
                  <div class="asr-mode-card">
                    <div class="asr-mode-title">远程 API</div>
                    <div class="asr-mode-desc">调用服务端 ASR 接口，需要网络连接</div>
                  </div>
                </label>
                <label class="asr-mode-option">
                  <input type="radio" name="asr-mode" value="local" id="asr-mode-local" />
                  <div class="asr-mode-card">
                    <div class="asr-mode-title">本地模型</div>
                    <div class="asr-mode-desc">离线运行，无需网络，首次需下载模型</div>
                  </div>
                </label>
              </div>
            </div>

            <!-- API 设置（仅 API 模式显示） -->
            <div id="api-settings" class="card">
              <h3>API 设置</h3>
              <div class="form-group">
                <label>ASR 服务端点地址</label>
                <input id="cfg-url" type="text" class="input" placeholder="http://localhost:3000" />
                <span class="tip">部署转写大模型的后台地址</span>
              </div>
            </div>

            <!-- 本地模型管理（仅本地模式显示） -->
            <div id="local-model-settings" class="card" style="display:none">
              <h3>本地模型管理</h3>
              <p class="desc" style="margin-bottom:12px">选择并下载 ASR 模型，下载后即可离线使用。</p>
              <div id="model-integrity-tip" class="model-integrity-tip" style="display:none"></div>
              <div id="model-list-hint" class="model-list-hint" style="display:none"></div>
              <div id="model-list" class="model-list"></div>
            </div>

            <!-- 通用设置 -->
            <div class="card">
              <div class="form-group">
                <label>组合热键 (推入录音)</label>
                <input id="cfg-hotkey" type="text" class="input" placeholder="Alt+Space" />
                <span class="tip">长按此键说话。</span>
              </div>
              <div class="form-group row-group">
                <label class="checkbox">
                  <input id="cfg-clipboard" type="checkbox" />
                  <span>启用剪贴板注入模式 (兼容大部分富文本型病历编辑器)</span>
                </label>
              </div>
              <div class="form-group row-group" style="display:none">
                <label class="checkbox">
                  <input id="cfg-vad" type="checkbox" />
                  <span>遗留VAD配置(已移到底层)</span>
                </label>
              </div>
            </div>
            <div class="actions-row">
              <div id="save-hint" class="save-hint"></div>
              <button id="save-btn" class="btn btn-primary">保存全部设置且重启服务</button>
            </div>
          </div>

          <!-- LLM大模型设置页 -->
          <div id="tab-llm" class="tab-pane">
            <h2 class="page-title">大语言模型配置 (OpenAI 兼容)</h2>
            <div class="card">
              <div class="form-group row-group">
                <label class="checkbox">
                  <input id="cfg-llm-enabled" type="checkbox" />
                  <span>启用划词与语音重写辅助特性 (需设置下方参数)</span>
                </label>
              </div>
              <div class="form-group">
                <label>Base URL</label>
                <input id="cfg-llm-baseurl" type="text" class="input" placeholder="https://api.openai.com/v1" />
                <span class="tip">遵循 OpenAI API 标准的端点根地址 (无兜底路由，必须填写)</span>
              </div>
              <div class="form-group">
                <label>API Key</label>
                <input id="cfg-llm-apikey" type="password" class="input" placeholder="sk-xxxxxx..." />
                <span class="tip">调用大模型的身份凭证凭证密钥</span>
              </div>
              <div class="form-group">
                <label>Model Name</label>
                <input id="cfg-llm-model" type="text" class="input" placeholder="gpt-4o-mini" />
                <span class="tip">具体用于重写的模型名称标志（如 qwen-max, gpt-3.5-turbo 等）</span>
              </div>
            </div>
            <div class="actions-row">
              <div id="llm-save-hint" class="save-hint"></div>
              <button id="llm-save-btn" class="btn btn-primary">保存大模型配置</button>
            </div>
          </div>

          <!-- 日志页 -->
          <div id="tab-logs" class="tab-pane">
            <h2 class="page-title">运行日志</h2>
            <p class="desc">实时查看应用运行日志，便于排查本地模型和识别问题。</p>
            <div class="log-card">
              <div class="log-toolbar">
                <button id="log-copy-btn" class="btn btn-outline" style="width:auto;padding:6px 12px">复制</button>
                <button id="log-clear-btn" class="btn btn-outline" style="width:auto;padding:6px 12px">清空</button>
              </div>
              <div id="log-container" class="log-container"></div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- 视图 3：Rewrite 独立改写窗体 -->
    <div id="rewrite-view" class="view">
      <div class="rewrite-container">
        <div class="rewrite-header">
          <span class="rw-title">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path
                d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9zM12 4.15L6.04 7.5 12 10.85l5.96-3.35L12 4.15zM5 15.91l6 3.38v-6.71L5 9.21v6.7zm14 0v-6.7l-6 3.38v6.71l6-3.38z" />
            </svg>智能重写
          </span>
          <button id="rw-close-btn" class="icon-btn" title="关闭窗口">×</button>
        </div>

        <div class="rw-body">
          <div class="rw-section" style="flex: 0 0 auto;">
            <div class="rw-label">原始文本 (已提取)</div>
            <textarea id="rw-original-text" class="rw-textarea" style="height: 100px; max-height: 120px;" readonly
              placeholder="划词提取内容将显示于此..."></textarea>
          </div>

          <div class="rw-section rw-instruction-section">
            <div class="rw-label">修改意图 (可键入或说话)</div>
            <div class="rw-input-bar">
              <input type="text" id="rw-instruction" class="rw-input" placeholder="请指示如何修改 (如: 语法纠错、语气委婉点)..." />
              <button id="rw-submit-btn" class="btn btn-primary btn-sm">生成</button>
            </div>
          </div>

          <div class="rw-section rw-result-section">
            <div class="rw-label" style="display:flex;justify-content:space-between;align-items:center;">
              <span>改写结果</span>
              <span id="rw-status-indicator" class="rw-status">等待指令</span>
            </div>
            <textarea id="rw-result-text" class="rw-textarea rw-result-textarea"
              placeholder="AI 润色结果将在此处流式生成..."></textarea>
          </div>
        </div>

        <div class="rw-footer">
          <button id="rw-cancel-btn" class="btn-ghost" title="快捷键: Esc">取消</button>
          <button id="rw-copy-btn" class="btn-ghost">复制</button>
          <button id="rw-replace-btn" class="btn-smooth" disabled title="快捷键: Cmd/Ctrl+Enter">替换文本</button>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
